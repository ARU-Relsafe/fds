PROGRAM HRR_PROFILE

! Read experimental HRR file and produce RAMP lines

CHARACTER(50) :: EXP_FILE,INPUT_FILE,TEST_ID
REAL :: HRR_0,HRR,TT
INTEGER :: I,T_END,TMPA,NOM_HRR,SEQ,II
REAL, DIMENSION(1000) :: T,V_DOT_NORTH,V_DOT_SOUTH

HRR_0 = 10000.
OPEN(9,FILE='paramfile.csv',FORM='FORMATTED')
READ(9,*)

DO I=1,81

   READ(9,*) INPUT_FILE,TEST_ID,T_END,TMPA,NOM_HRR,SEQ

   EXP_FILE = '../../../../exp/Memorial_Tunnel/HR'//TRIM(TEST_ID)//'.csv'
   OPEN(10,FILE=EXP_FILE,FORM='FORMATTED')
   READ(10,*)
   READ(10,*)
   OPEN(11,FILE=INPUT_FILE,FORM='FORMATTED',STATUS='OLD',ACCESS='APPEND')
   DO 
      READ(10,*,END=20) TT,HRR
      WRITE(11,'(A,F5.0,A,F7.3,A)') "&RAMP ID='RAMP_FIRE', T=",TT,", F=",MAX(0.,HRR/HRR_0)," /"
   ENDDO

   20 CONTINUE
   WRITE(11,*)

   SELECT CASE(SEQ)
      CASE(1)   ; N_SOUTH_VENTS=100 ; N_NORTH_VENTS=156
      CASE(3)   ; N_SOUTH_VENTS=78  ; N_NORTH_VENTS=78
      CASE(4)   ; N_SOUTH_VENTS=100 ; N_NORTH_VENTS=100
      CASE(5)   ; N_SOUTH_VENTS=78  ; N_NORTH_VENTS=78
      CASE(6)   ; N_SOUTH_VENTS=78  ; N_NORTH_VENTS=78
      CASE(8)   ; N_SOUTH_VENTS=78  ; N_NORTH_VENTS=78
      CASE(9)   ; N_SOUTH_VENTS=1   ; N_NORTH_VENTS=2
      CASE(101) ; N_SOUTH_VENTS=1   ; N_NORTH_VENTS=1
      CASE(13)  ; N_SOUTH_VENTS=78  ; N_NORTH_VENTS=78
      CASE(14)  ; N_SOUTH_VENTS=78  ; N_NORTH_VENTS=78
   END SELECT

   CLOSE(10)
   EXP_FILE = '../../../../exp/Memorial_Tunnel/AP'//TRIM(TEST_ID)//'.csv'
   OPEN(10,FILE=EXP_FILE,FORM='FORMATTED')
   READ(10,*)
   READ(10,*)
   N = 1
   DO II=1,1000
      READ(10,*,END=30) T(N),V_DOT_SOUTH(N),V_DOT_NORTH(N)
      N = N+1
   ENDDO
   30 CONTINUE
   DO II=1,N-1
      WRITE(11,'(A,F5.0,A,F7.2,A)') "&RAMP ID='RAMP_SOUTH', T=",T(II),", F=",ABS(V_DOT_SOUTH(II)/REAL(N_SOUTH_VENTS))," /"
   ENDDO
   WRITE(11,*)
   DO II=1,N-1
      WRITE(11,'(A,F5.0,A,F7.2,A)') "&RAMP ID='RAMP_NORTH', T=",T(II),", F=",ABS(V_DOT_NORTH(II)/REAL(N_NORTH_VENTS))," /"
   ENDDO

   WRITE(11,*)
   WRITE(11,'(A)') "&TAIL /"
ENDDO

END PROGRAM HRR_PROFILE

